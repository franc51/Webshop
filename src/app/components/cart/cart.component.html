<app-spinner *ngIf="isLoading"></app-spinner>
<h2 class="your_cart">Your Cart</h2>

<div class="cart_and_checkout">
  <div *ngIf="!isLoading" class="cart_container">
    <div *ngIf="cartProducts.length === 0" class="empty-cart">
      <p>Your cart is empty.</p>
      <img
        src="https://img.freepik.com/premium-vector/shopping-cart-with-cross-mark-wireless-paymant-icon-shopping-bag-failure-paymant-sign-online-shopping-vector_662353-912.jpg"
        alt="Empty cart"
      />
    </div>

    <table *ngIf="cartProducts.length > 0" class="cart_table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Price (Lei)</th>
          <th>Quantity</th>
          <th>Subtotal (Lei)</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of cartProducts">
          <td class="product_cell">
            <img [src]="product.pictureUrl" alt="{{ product.name }}" />
            <span>{{ product.name }}</span>
          </td>
          <td>{{ product.price.toFixed(2) }}</td>
          <td>
            <div class="quantity_controls">
              <button (click)="decreaseQuantity(product._id)">-</button>
              <span>{{ quantities[product._id] || 1 }}</span>
              <button (click)="increaseQuantity(product._id)">+</button>
            </div>
          </td>
          <td>
            {{ (product.price * (quantities[product._id] || 1)).toFixed(2) }}
          </td>
          <td>
            <button (click)="removeFromCart(product._id)" class="remove_button">
              <img src="/assets/images/del.svg" alt="Remove" />
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="cartProducts.length > 0" class="checkout_container">
    <p><strong>Address:</strong></p>
    <select [(ngModel)]="selectedAddress" class="address_dropdown">
      <option *ngFor="let address of addresses" [value]="address">
        {{ address }}
      </option>
    </select>

    <p><strong>Credit Card:</strong></p>
    <select [(ngModel)]="selectedCard" class="card_dropdown">
      <option *ngFor="let card of creditCards" [value]="card">
        **** **** **** {{ card.slice(-4) }}
      </option>
    </select>

    <p><strong>Shipping:</strong> Free</p>

    <div *ngIf="cartProducts.length > 0" class="cart-total">
      <h3>Total: {{ total.toFixed(2) }} Lei</h3>
    </div>

    <button (click)="checkout()">Checkout</button>
  </div>
</div>
